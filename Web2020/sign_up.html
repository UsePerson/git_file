<!DOCTYPE html>
<html lang="en">
	<head>
		<!-- Required meta tags -->
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
		<meta name="description" content="This web is FJU CSIE web project -- chatroom project">
		<meta name="author" content="CrazyFire, DogQ, Nicky, USER">
		<meta name="generator" content="Jekyll v4.0.1">

		<title>Sign up | ChatRoom</title>

		<!-- bootstrap JS include -->
		<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
		<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
		<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js" integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI" crossorigin="anonymous"></script>
		<script src="https://kit.fontawesome.com/c78a8bbd32.js" crossorigin="anonymous"></script>
		
		<!-- bootstrap css include -->
		<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css" integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
		<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js" integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI" crossorigin="anonymous"></script>

		<style>
			.bd-placeholder-img {
				font-size: 1.125rem;
				text-anchor: middle;
				-webkit-user-select: none;
				-moz-user-select: none;
				-ms-user-select: none;
				user-select: none;
			}

			@media (min-width: 768px) {
				.bd-placeholder-img-lg {
					font-size: 3.5rem;
				}
			}
		</style>

		<!-- Custom styles for this template -->
		
		<link href="/css/sign_up.css" rel="stylesheet">
		<link href="/css/setup.css" rel="stylesheet">
	</head>

	<body>
		<header>
			<div class="d-flex flex-column flex-md-row align-items-center p-3 px-md-4 mb-3 bg-dark fixed-top border-bottom shadow-sm">
				<nav class="navbar navbar-expand-md navbar-dark my-0 mr-md-auto font-weight-normal justify-content-between">
					<a class="navbar-brand text-white" href="/index.html">FJU ChatRoom</a>
				</nav>
				<a class="btn btn-outline-light my-2 my-md-0 mr-md-3 disabled" href="/sign_up.html" aria-disabled="true">Sign up</a>
				<a class="btn btn-outline-light my-2 my-md-0 mr-md-3" href="/sign_in.html">Sign in</a>
			</div>
		</header>
		<main class="form-signin">
			<div>
				<h1 class="h3 mb-3 font-weight-normal">Please sign up</h1>
				<label for="inputEmail" class="sr-only">Email address</label>
				<input type="email" id="inputEmail" class="form-control" placeholder="Email address" autofocus>
				<label for="inputPassword" class="sr-only">Password</label>
				<input type="password" id="inputPassword" class="form-control" placeholder="Password">
				<button class="btn btn-lg btn-primary btn-block" type="submit" id="submit">Sign up</button>
				<label id="message"></label>
			</div>
		</main>
		<!-- <footer>

		</footer> -->
		<!-- The core Firebase JS SDK is always required and must be listed first -->
		<script src="https://www.gstatic.com/firebasejs/7.14.5/firebase-app.js"></script>
		<!-- TODO: Add SDKs for Firebase products that you want to use
			https://firebase.google.com/docs/web/setup#available-libraries -->
		<script src="https://www.gstatic.com/firebasejs/7.14.5/firebase-analytics.js"></script>
		<script src="https://www.gstatic.com/firebasejs/7.14.5/firebase-auth.js"></script>
		<script src="https://www.gstatic.com/firebasejs/7.14.5/firebase-database.js"></script>
		<script>
		// Your web app's Firebase configuration
		var firebaseConfig = {
			apiKey: "AIzaSyCAOj-dhi5ABTjcwRRuse4b8gckv9gb1cA",
			authDomain: "web-2020-9016a.firebaseapp.com",
			databaseURL: "https://web-2020-9016a.firebaseio.com",
			projectId: "web-2020-9016a",
			storageBucket: "web-2020-9016a.appspot.com",
			messagingSenderId: "235406339567",
			appId: "1:235406339567:web:d38bd8667b2b5de7659a1a",
			measurementId: "G-MF4J99D3Y9"
		};
		// Initialize Firebase
		firebase.initializeApp(firebaseConfig);
		firebase.analytics();
		const database = firebase.database();

		submit.addEventListener('click', () => {
			var email = document.getElementById('inputEmail').value;
			var password = document.getElementById('inputPassword').value;
			if (email.length < 4) {
				alert('Please enter an email address.');
				return;
			}
			if (password.length == 0) {
				alert('Please enter a password.');
				return;
			}
			// Create user with email and pass.
			// [START createwithemail]
			firebase.auth().createUserWithEmailAndPassword(email, password)
			.then( u => {
				let date = new Date();
                let now = date.getTime();
				let userPath = "/user_information/" + u.user.uid ;
				
				const ref = firebase.database().ref(userPath);
               	ref.set({

					time: now	
                });

				message.innerHTML ="\<meta http-equiv = \"refresh\" content = \"0; url = \/sign_in.html\" \/\>";
			})
			.catch(function(error) {
				// Handle Errors here.
				var errorCode = error.code;
				var errorMessage = error.message;
				// [START_EXCLUDE]
				if (errorCode == 'auth/weak-password') {
					alert('The password is too weak.');
				} else {
					alert(errorMessage);
					if( errorMessage == "The email address is already in use by another account." ){
						message.innerHTML ="\<meta http-equiv = \"refresh\" content = \"0; url = \/sign_in.html\" \/\>";
					}
				}
				console.log(error);
				// [END_EXCLUDE]
			});
			// [END createwithemail]
		});
		</script>
	</body>
</html>