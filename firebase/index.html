<!Doctype html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>這是測試的</title>
        <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
        <script src="https://www.gstatic.com/firebasejs/5.5.6/firebase.js"></script>
    </head>

    <body>

        <!--register test -->
		<label>帳號: &nbsp;</label>
		<input type="text" name="username" placeholder="Username" style="font-size: 18px;" id="email"required><br>

		<div>
            <label>密碼: &nbsp;</label>
		    <input type="Password" name="password" placeholder="Password" style="font-size: 18px;"id="pwd" required><br>
            <button type="submit" id="submit">註冊</button>
            <label id="message"></label>
            
		</div>
        <script>
 
            var config = {
            apiKey: "AIzaSyCZdATwQbOLSyphRRzzwbg9QF5_8I4tvWI",
            authDomain: "test-d3318.firebaseapp.com",
            databaseURL: "https://test-d3318.firebaseio.com",
            storageBucket: "test-d3318.appspot.com",
            //messagingSenderId: "<SENDER_ID>",
            };
            firebase.initializeApp(config);
            const database = firebase.database();
            // 綁定註冊按鈕的點擊事件
            submit.addEventListener('click', () => {
            // 點擊註冊按鈕時，紀錄使用者輸入的帳號密碼
            let user = {
                email: email.value,
                pwd: pwd.value
            };

            // 透過 auth().createUserWithEmailAndPassword 建立使用者
            firebase.auth().createUserWithEmailAndPassword(user.email, user.pwd)
            .then(u => {
            // 取得註冊當下的時間
                let date = new Date();
                let now = date.getTime();

            // 記錄相關資訊到 firebase realtime database
                    database.ref(u.uid).set({
                        signup: now,
                        email: user.email
                        }).then(() => {
                // 儲存成功後顯示訊息
                            message.innerHTML = '你終於成功';
                        });
                    }).catch(err => {
              // 註冊失敗時顯示錯誤訊息
                    message.innerHTML = err.message;
                });
            });


            /*加在firebase的規則
            {
                "rules": {
                ".read": false,
                ".write": false,
                    "$data": {
                        ".read": true,
                        ".write": "!data.exists()",
                    }
                }
            }
            */
        </script>
    </body>
</html>